var EventAjaxFilters=(EventAjaxFilters=function(){var i,E=[];return{init:function(){Common.logInfo("EventAjaxFilters.init..."),0<jQuery(".wpem-search-event-more-filter").length&&(jQuery(".wpem-event-advace-filter").hide(),jQuery(".wpem-search-event-more-filter").on("click",function(){jQuery(".wpem-event-advace-filter").slideToggle("slow")})),jQuery.isFunction(jQuery.fn.chosen)&&(1==event_manager_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_event_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_event_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),i=!(!window.history||!window.history.pushState),jQuery(document).ready(EventAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_events",EventAjaxFilters.actions.loadMoreEvents),jQuery(".event_filters").on("click",".reset",EventAjaxFilters.actions.eventAjaxFiltersReset),jQuery("div.event_listings").on("click",".event-manager-pagination a",EventAjaxFilters.actions.eventPagination),jQuery(".event_listings").on("update_event_listings",EventAjaxFilters.actions.getEventListings),jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_event_types, #search_ticket_prices, .event-manager-filter").change(function(){var e=jQuery(this).closest("div.event_listings");e.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.event_manager_store_state(e,1)}).on("keyup",function(e){13===e.which&&jQuery(this).trigger("change")})},event_manager_store_state:function(e,t){Common.logInfo("EventAjaxFilters.event_manager_store_state...");var n,a=document.location.href.split("#")[0];i&&(n=e.find(".event_filters"),n=jQuery(n).serialize(),e=jQuery("div.event_listings").index(e),window.history.replaceState({id:"event_manager_state",page:t,data:n,index:e},"",a+"#events"))},actions:{windowLoad:function(e){Common.logInfo("EventAjaxFilters.actions.windowLoad..."),jQuery(".event_filters").each(function(){var e,t=jQuery(this).closest("div.event_listings"),n=t.find(".event_filters"),a=1,i=jQuery("div.event_listings").index(t);window.history.state&&window.location.hash&&((e=window.history.state).id&&"event_manager_state"===e.id&&i==e.index&&(a=1,n.deserialize(e.data),n.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),n.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),n.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),n.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))),t.triggerHandler("update_event_listings",[a,!1])})},eventAjaxFiltersReset:function(e){Common.logInfo("EventAjaxFilters.actions.eventAjaxFiltersReset...");var t=jQuery(this).closest("div.event_listings"),n=jQuery(this).closest("form");return n.find(':input[name="search_keywords"], :input[name="search_location"], .event-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),n.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),n.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),n.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),n.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),t.triggerHandler("reset"),t.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.event_manager_store_state(t,1),!1},loadMoreEvents:function(e){Common.logInfo("EventAjaxFilters.actions.loadMoreEvents...");var t=jQuery(this).closest("div.event_listings"),n=parseInt(jQuery(this).data("page")||1);return jQuery(this).addClass("wpem-loading"),n+=1,jQuery(this).data("page",n),EventAjaxFilters.event_manager_store_state(t,n),t.triggerHandler("update_event_listings",[n,!0,!1]),!1},eventPagination:function(e){Common.logInfo("EventAjaxFilters.actions.eventPagination...");var t=jQuery(this).closest("div.event_listings"),n=jQuery(this).data("page");return EventAjaxFilters.event_manager_store_state(t,n),t.triggerHandler("update_event_listings",[n,!1]),jQuery("body, html").animate({scrollTop:t.offset().top},600),!1},getEventListings:function(e,t,n,a){Common.logInfo("EventAjaxFilters.actions.getEventListings...");var i,r,s,o,d,l,c,_,g="",u=jQuery(this),v=u.find(".event_filters"),p=u.find(".showing_applied_filters"),h=u.find(".event_listings"),m=u.data("per_page"),y=u.data("orderby"),j=u.data("order"),f=u.data("featured"),Q=u.data("cancelled"),w=u.data("event_online"),x=jQuery("div.event_listings").index(this);x<0||(E[x]&&E[x].abort(),n||(jQuery(h).addClass("wpem-loading"),jQuery("div.event_listing, div.no_event_listings_found",h).css("visibility","hidden"),u.find(".load_more_events").data("page",t)),g=1==u.data("show_filters")?(d=v.find(':input[name^="search_datetimes"]').map(function(){return jQuery(this).val()}).get(),0<jQuery("input.date_range_picker").length&&jQuery("input.date_range_picker").daterangepicker(),l=v.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),c=v.find(':input[name^="search_event_types"]').map(function(){return jQuery(this).val()}).get(),_=v.find(':input[name^="search_ticket_prices"]').map(function(){return jQuery(this).val()}).get(),o=s="",i=v.find(':input[name="search_keywords"]'),r=v.find(':input[name="search_location"]'),i.val()!==i.attr("placeholder")&&(s=i.val()),r.val()!==r.attr("placeholder")&&(o=r.val()),0<jQuery(':input[name="event_online"]').length&&(w=1==jQuery(':input[name="event_online"]').prop("checked")?"true":""),{lang:event_manager_ajax_filters.lang,search_keywords:s,search_location:o,search_datetimes:d,search_categories:l,search_event_types:c,search_ticket_prices:_,per_page:m,orderby:y,order:j,page:t,featured:f,cancelled:Q,event_online:w,show_pagination:u.data("show_pagination"),form_data:v.serialize()}):(s=u.data("keywords"),o=u.data("location"),d=u.data("datetimes"),l=u.data("categories"),c=u.data("event_types"),_=u.data("ticket_prices"),l=l&&l.split(","),{lang:event_manager_ajax_filters.lang,search_keywords:s,search_location:o,search_datetimes:d,search_categories:l,search_event_types:c,search_ticket_prices:_,per_page:m,orderby:y,order:j,page:t,featured:f,cancelled:Q,event_online:w,show_pagination:u.data("show_pagination")}),E[x]=jQuery.ajax({type:"POST",url:event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:g,success:function(e){if(e)try{e.filter_value?jQuery(p).show().html("<span>"+e.filter_value+"</span>"+e.showing_links):jQuery(p).hide(),e.showing_applied_filters?jQuery(p).addClass("showing-applied-filters"):jQuery(p).removeClass("showing-applied-filters"),e.html&&(n&&a?(jQuery(h).prepend(e.html),0<jQuery("div.google-map-loadmore").length&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):n?(jQuery(h).append(e.html),0<jQuery("div.google-map-loadmore").length&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(h).html(e.html)),1==u.data("show_pagination")?(u.find(".event-manager-pagination").remove(),e.pagination&&u.append(e.pagination)):(localStorage.setItem("total_event_page",e.max_num_pages),localStorage.setItem("current_event_page",t),!e.found_events||e.max_num_pages<=t?jQuery(".load_more_events:not(.load_previous)",u).hide():a||jQuery(".load_more_events",u).show(),jQuery(".load_more_events",u).removeClass("wpem-loading"),jQuery("li.event_listing",h).css("visibility","visible")),jQuery(h).removeClass("wpem-loading"),u.triggerHandler("updated_results",e)}catch(e){window.console&&Common.logError(e)}},error:function(e,t,n){window.console&&"abort"!==t&&Common.logError(t+": "+n)},statusCode:{404:function(){window.console&&Common.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),e.preventDefault())}}}})();jQuery(document).ready(function(e){EventAjaxFilters.init()});
